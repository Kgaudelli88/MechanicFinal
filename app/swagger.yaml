---
swagger: "2.0"
info:
  title: Mechanic Shop API
  version: 1.0.0
  description: API documentation for the Mechanic Shop project
host: mechanicfinal.onrender.com
basePath: /
tags:
  - name: Customers
    description: Customer management
  - name: Mechanics
    description: Mechanic management
  - name: ServiceTickets
    description: Service ticket management
  - name: Assignments
    description: Mechanic-service ticket assignments
paths:
  /customers/:
    post:
      tags: [Customers]
      summary: Register a new customer
      description: Create a new customer account
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/CustomerPayload"
      responses:
        201:
          description: Customer created
          schema:
            $ref: "#/definitions/CustomerResponse"
    get:
      tags: [Customers]
      summary: Get all customers
      description: Returns a paginated list of customers
      parameters:
        - name: page
          in: query
          required: false
          type: integer
        - name: per_page
          in: query
          required: false
          type: integer
      responses:
        200:
          description: List of customers
          schema:
            type: object
            properties:
              customers:
                type: array
                items:
                  $ref: "#/definitions/CustomerResponse"
              total:
                type: integer
              page:
                type: integer
              pages:
                type: integer
  /customers/{id}:
    get:
      tags: [Customers]
      summary: Get a customer by ID
      description: Returns a single customer
      parameters:
        - name: id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: Customer details
          schema:
            $ref: "#/definitions/CustomerResponse"

  # Removed duplicate and mis-indented put block under /customers/me
    put:
      tags: [Customers]
      summary: Update logged-in customer
      description: Update the currently authenticated customer (requires JWT token)
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: Bearer JWT token
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/CustomerPayload"
      responses:
        200:
          description: Customer updated
          schema:
            $ref: "#/definitions/CustomerResponse"

  /customers/me:
    delete:
      tags: [Customers]
      summary: Delete logged-in customer
      description: Delete the currently authenticated customer (requires JWT token)
      parameters:
        - name: Authorization
          in: header
          required: true
          type: string
          description: Bearer JWT token
      responses:
        200:
          description: Customer deleted
          schema:
            type: object
            properties:
              message:
                type: string
  /mechanics/:
    post:
      tags: [Mechanics]
      summary: Register a new mechanic
      description: Create a new mechanic account
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/MechanicPayload"
      responses:
        201:
          description: Mechanic created
          schema:
            $ref: "#/definitions/MechanicResponse"
    get:
      tags: [Mechanics]
      summary: Get all mechanics
      description: Returns a paginated list of mechanics
      parameters:
        - name: page
          in: query
          required: false
          type: integer
        - name: per_page
          in: query
          required: false
          type: integer
      responses:
        200:
          description: List of mechanics
          schema:
            type: object
            properties:
              mechanics:
                type: array
                items:
                  $ref: "#/definitions/MechanicResponse"
              total:
                type: integer
              page:
                type: integer
              pages:
                type: integer
  /mechanics/{id}:
    get:
      tags: [Mechanics]
      summary: Get a mechanic by ID
      description: Returns a single mechanic
      parameters:
        - name: id
          in: path
          required: true
          type: integer
      responses:
        200:
          description: Mechanic details
          schema:
            $ref: "#/definitions/MechanicResponse"
    put:
      tags: [Mechanics]
      summary: Update a mechanic
      description: Update mechanic details by ID
      parameters:
        - name: id
          in: path
          required: true
          type: integer
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/MechanicPayload"
      responses:
        200:
          description: Mechanic updated
          schema:
            $ref: "#/definitions/MechanicResponse"
    delete:
      tags: [Mechanics]
      summary: Delete a mechanic
      description: Delete mechanic by ID
      parameters:
        - name: id
          in: path
          required: true
          type: integer
      responses:
        204:
          description: Mechanic deleted
  /mechanics/by-ticket-count:
    get:
      tags: [Mechanics]
      summary: Get mechanics by ticket count
      description: Returns mechanics ordered by number of tickets worked on
      responses:
        200:
          description: List of mechanics
          schema:
            type: object
            properties:
              mechanics:
                type: array
                items:
                  $ref: "#/definitions/MechanicResponse"
  # Removed erroneous patch marker
          type: integer
      responses:
        204:
          description: Mechanic deleted
  /customers/:
    post:
      tags: [Customers]
      summary: Register a new customer
      description: Create a new customer account
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/CustomerPayload"
      responses:
        201:
          description: Customer created
          schema:
            $ref: "#/definitions/CustomerResponse"
          examples:
            application/json:
              id: 1
              name: Jordan
              email: jordan@mail.com
              phone: 448-483-2248
    get:
      tags: [Customers]
      summary: Get all customers
      description: Returns a paginated list of customers
      responses:
        200:
          description: List of customers
          schema:
            type: object
            properties:
              customers:
                type: array
                items:
                  $ref: "#/definitions/CustomerResponse"
              total:
                type: integer
              page:
                type: integer
              pages:
                type: integer

  /customers/login:
    post:
      tags: [Customers]
      summary: Customer login
      description: Returns a JWT token
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/LoginPayload"
      responses:
        200:
          description: JWT token
          schema:
            type: object
            properties:
              token:
                type: string
          examples:
            application/json:
              token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

  /service-tickets/:
    post:
      tags: [ServiceTickets]
      summary: Create a new service ticket
      description: Create a new service ticket for a customer
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/ServiceTicketPayload"
      responses:
        201:
          description: Service ticket created
          schema:
            $ref: "#/definitions/ServiceTicketResponse"
    get:
      tags: [ServiceTickets]
      summary: Get all service tickets
    /service-tickets/{id}:
      get:
        tags: [ServiceTickets]
        summary: Get a service ticket by ID
        description: Returns a single service ticket
        parameters:
          - name: id
            in: path
            required: true
            type: integer
        responses:
          200:
            description: Service ticket details
            schema:
              $ref: "#/definitions/ServiceTicketResponse"

    /customers/{id}:
      put:
        tags: [Customers]
        summary: Update a customer
        description: Update customer details by ID
        parameters:
          - name: id
            in: path
            required: true
            type: integer
          - in: body
            name: body
            required: true
            schema:
              $ref: "#/definitions/CustomerPayload"
        responses:
          200:
            description: Customer updated
            schema:
              $ref: "#/definitions/CustomerResponse"

      /customers/me:
        delete:
          tags: [Customers]
          summary: Delete logged-in customer
          description: Delete the currently authenticated customer (requires JWT token)
          parameters:
            - name: Authorization
              in: header
              required: true
              type: string
              description: Bearer JWT token
          responses:
            200:
              description: Customer deleted
              schema:
                type: object
                properties:
                  message:
                    type: string

  /service-tickets/mechanic-service-ticket/:
    post:
      tags: [Assignments]
      summary: Assign mechanic to service ticket
      description: Assign a mechanic to a service ticket with a status
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: "#/definitions/AssignmentPayload"
      responses:
        201:
          description: Assignment created
          schema:
            type: object
            properties:
              message:
                type: string
          examples:
            application/json:
              message: Mechanic assigned to service ticket with status.
    get:
      tags: [Assignments]
      summary: Get all assignments
      description: Returns all mechanic-service ticket assignments
      responses:
        200:
          description: List of assignments
          schema:
            type: array
            items:
              $ref: "#/definitions/AssignmentResponse"

definitions:
  CustomerPayload:
    type: object
    required:
      - name
      - email
      - password
      - phone
    properties:
      name:
        type: string
      email:
        type: string
      password:
        type: string
      phone:
        type: string
  CustomerResponse:
    type: object
    properties:
      id:
        type: integer
      name:
        type: string
      email:
        type: string
      phone:
        type: string
  LoginPayload:
    type: object
    required:
      - email
      - password
    properties:
      email:
        type: string
      password:
        type: string
  MechanicPayload:
    type: object
    required:
      - name
      - email
      - password
      - phone
    properties:
      name:
        type: string
      email:
        type: string
      password:
        type: string
      phone:
        type: string
  MechanicResponse:
    type: object
    properties:
      id:
        type: integer
      name:
        type: string
      email:
        type: string
      phone:
        type: string
  ServiceTicketPayload:
    type: object
    required:
      - VIN
      - description
      - make
      - model
      - service_date
      - year
      - customer_id
    properties:
      VIN:
        type: string
      description:
        type: string
      make:
        type: string
      model:
        type: string
      service_date:
        type: string
        format: date
      year:
        type: integer
      customer_id:
        type: integer
  ServiceTicketResponse:
    type: object
    properties:
      id:
        type: integer
      VIN:
        type: string
      year:
        type: integer
      make:
        type: string
      model:
        type: string
      description:
        type: string
      service_date:
        type: string
        format: date
      customer_id:
        type: integer
  AssignmentPayload:
    type: object
    required:
      - mechanic_id
      - service_ticket_id
      - status
    properties:
      mechanic_id:
        type: integer
      service_ticket_id:
        type: integer
      status:
        type: string
  AssignmentResponse:
    type: object
    properties:
      mechanic_id:
        type: integer
      service_ticket_id:
        type: integer
      status:
        type: string
